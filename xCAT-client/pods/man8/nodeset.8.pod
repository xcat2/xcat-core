=head1 Name

B<nodeset> - set the boot state for a noderange

=head1 B<Synopsis>

B<nodeset> [I<noderange>] [I<boot>|I<install>|I<stat>|I<iscsiboot>|I<netboot>|I<statelite>|I<offline>|I<runcmd=bmcsetup>|I<osimage[=<imagename>>]|I<shell>|I<shutdown>]

B<nodeset> I<noderange> I<osimage=<imagename>> [I<--noupdateinitrd>] [I<--ignorekernelchk>]

B<nodeset> [I<-h>|I<--help>|I<-v>|I<--version>]

=head1 B<Description>

B<nodeset>  sets the next boot state for a single or range of
nodes or groups.  It tells xCAT what you want to happen the next time the
nodes are booted up.  See  L<noderange(3)|noderange.3>.   B<nodeset>  accomplishes  this  by
changing  the network boot files.  Each xCAT node always boots from the
network and downloads a boot file with instructions on what  action  to
take next.

B<nodeset> will manipulate the boot configuration files of yaboot and pxelinux.0.

Assume that /tftpboot is the root for tftpd (set in L<site(5)|site.5>).

B<nodeset> for pxe makes changes to /tftpboot/pxelinux.cfg/{node hex ip}

B<nodeset> for yaboot makes changes to /tftpboot/etc/{node hex ip}

B<nodeset> only sets the next boot state, but does not reboot.

B<nodeset>  is  called  by rinstall and winstall and is also called by the
installation process remotely to set the boot state back to "boot".

A user can supply their own scripts to be run on the mn or on the service node (if a hierarchical cluster) for a node when the nodeset command is run. Such scripts are called B<prescripts>. They should be copied to /install/prescripts dirctory. A table called I<prescripts> is used to specify the scripts and their associated actions. The scripts to be run at the beginning of the nodeset command are stored in the 'begin' column of I<prescripts> table. The scripts to be run at the end of the nodeset command are stored in the 'end' column of I<prescripts> table. You can run 'tabdump prescripts -d' command for details. The following two environment variables will be passed to each script: NODES contains all the names of the nodes that need to run the script for and ACTION contains the current nodeset action. If I<#xCAT setting:MAX_INSTANCE=number> is specified in the script, the script will get invoked for each node in parallel, but no more than I<number> of instances will be invoked at at a time. If it is not sepcified, the script will be invoked once for all the nodes.


=head1 B<Options>

=over 7

=item B<boot>

Instruct network boot loader to be skipped, generally meaning boot to hard disk

=item B<install>|B<install=profilename>|B<install=<os-architecture-profilename>>

Prepare server for installing a node according to the table configuration.  This will
typically mean an unattended install file is created (i.e. kickstart or autoyast),
install resources will be verified in tftp and the bulk transfer method (http, ftp, or nfs for example), and the boot loader configuration file will be written.
Note: this option has been deprecated and will be removed in a future release.  You should change to using the osimage option instead.


=item B<netboot>|B<netboot=profilename>|B<netboot=<os-architecture-profilename>>

Prepare server for deploying diskless nodes. With the diskless solution, the os image will reside in the RAM of the node. 
Note: this option has been deprecated and will be removed in a future release.  You should change to using the osimage option instead. 

=item B<statelite>|B<statelite=profilename>|B<statelite=<os-architecture-profilename>>

Prepare server for deploying statelite nodes. Statelite provides an efficient and flexible diskless solution because most of the OS image is NFS mounted read-only, but a configurable list of directories and files can be read-write. The read-write files can either be persistent across reboots, or volatile (restoring to pristine state after reboot). The configuration can be  done through B<litefile>, B<litetree> and B<statelite> tables. 
Note: this option has been deprecated and will be removed in a future release.  You should change to using the osimage option instead.

=item B<offline>

Cleanup the current pxe/tftp boot configuration files for the nodes requested

=item B<osimage>|B<osimage=<imagename>>

Prepare server for installing a node using the specified os image. The os image is defined in the I<osimage> table and I<linuximage> table. If the <imagename> is omitted, the os image name will be obtained from I<nodetype.provmethod> for the node.  

=item B<--noupdateinitrd>

Skip the rebuilding of initrd when the 'netdrivers', 'drvierupdatesrc' or 'osupdatename' were set for injecting new drviers to initrd. But, the geninitrd command
should be run to rebuild the initrd for new drivers injecting. This is used to improve the performance of nodeset command.

=item B<--ignorekernelchk>

Skip the kernel version checking when injecting drivers from osimage.driverupdatesrc. That means all drivers from osimage.driverupdatesrc will be injected to initrd for the specific target kernel.

=item B<runimage>=<task>>

If you would like to run a task after deployment, you can define that task with this attribute.    

=item B<stat>

Display the current boot loader config file description for the nodes requested

=item B<runcmd=bmcsetup>

This instructs the node to boot to the xCAT nbfs environment and proceed to configure BMC
for basic remote access.  This causes the IP, netmask, gateway, username, and password to be programmed according to the configuration table.

=item B<shell>

This instructs tho node to boot to the xCAT genesis environment, and present a shell prompt on console.
The node will also be able to be sshed into and have utilities such as wget, tftp, scp, nfs, and cifs.  It will have storage drivers available for many common systems.

=item B<shutdown>

To make the node to get into power off status. This status only can be used after B<runcmd> and B<runimage> to power off the node after the performing of operations.

=item B<-h>|B<--help>

Print help.

=item B<-v>|B<--version>

Print version.

=back


=head1 B<Files>

B<noderes> table -
xCAT  node  resources  file.   See  L<noderes(5)|noderes.5>  for  further
details.

B<nodetype> table -
xCAT node installation type file.  See L<nodetype(5)|nodetype.5> for  fur-
ther  details.   This is used to determine the node installation
image type.

B<site> table -
xCAT main  configuration  file.   See  L<site(5)|site.5>  for  further
details.   This  is  used  to determine the location of the TFTP
root directory and the TFTP xCAT  subdirectory.   /tftpboot  and
/tftpboot/xcat is the default.

=head1 B<Examples>

=over 3

=item *

To setup to install mycomputeimage on the compute node group.

nodeset compute osimage=mycomputeimage

=item *

To run http://$master/image.tgz  after deployment:

nodeset $node runimage=http://$MASTER/image.tgznodeset

=back

=head1 B<See> B<Also>

L<noderange(3)|noderange.3>, L<nodels(1)|nodels.1>, L<nodestat(1)|nodestat.1>, L<rinstall(8)|rinstall.8>,
L<makedhcp(8)|makedhcp.8>, L<osimage(7)|osimage.7>
